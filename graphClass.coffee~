


class Graph
   @maxWeight = 10000

   constructor: (nodes, links) ->
       @nodes = nodes
       @links = links

       @edgeWeights = (l.weight for l in links)
       @numNodes = nodes.length

       @shortestPaths = {}
       @shortestPathsParents = {}

       @nodesDir = {}
       @linksDir = {}
       @linksAdjDir = {}
       for l in links
           if not @linksDir[l.to]
               @linksDir[l.to] = {}
           if not @linksDir[l.from]
               @linksDir[l.from] = {}

           @linksDir[l.to][l.from] = l.id
           @linksDir[l.from][l.to] =  l.id

           @linksAdjDir[l.id] = [l.to, l.from]

           if not @nodesDir[l.to]
               @nodesDir[l.to] = []
           if not @nodesDir[l.from]
               @nodesDir[l.from] = []

           @nodesDir[l.to].push(l.from)
           @nodesDir[l.from].push(l.to)

   @dist: (pair) ->
       from = pair[0]
       to = pair[1]
       if @shortestPaths[from]?
	  return @shortestPaths[from][to]
       else if @shortestPaths[to]?
	  return @shortestPaths[to][from]
       else
	  result = djikstra @nodesDir, @linksDir, to
	  @shortestPaths[from] = result.distances
	  @shortestPathsParents[from] = result.parents
	  return @shortestPaths[from][to]

   @parent: (pair) ->
       from = pair[0]
       to = pair[1]
       if @shortestPaths[from]?
	  return @shortestPathsParents[from][to]
       else
	  result = djikstra @nodesDir, @linksDir, to
	  @shortestPaths[from] = result.distances
	  @shortestPathsParents[from] = result.parents
	  return @shortestPaths[from][to]

   @toNodeAllParents: (pair) ->
       from = pair[0]
       to = pair[1]
       if @shortestPaths[from]?
	  return @shortestPathsParents[from]
       else
	  result = djikstra @nodesDir, @linksDir, to
	  @shortestPaths[from] = result.distances
	  @shortestPathsParents[from] = result.parents
	  return @shortestPathsParents[from]






links = [{id:0, to:5, from:1, weight:99}, {id:1, to:2, from:1, weight:2}, {id:2, to:3, from:1, weight:2}, {id:3, to:3, from:5, weight:1}, {id:4, to:2, from:4, weight:1}, {id:5, to:3, from:4, weight:5}, {id:6, to:0, from:1, weight:10}]
nodes = [0..5]
graph = new Graph(nodes, links)
console.log graph
